# åˆåŒé¢„å®¡ç³»ç»ŸPythoné‡æ„æ–¹æ¡ˆ - æ‰§è¡Œæ‘˜è¦

## ğŸ¯ é‡æ„ç›®æ ‡

å°†ç°æœ‰çš„å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿç®€åŒ–ä¸º**å•æœºPythonåº”ç”¨**ï¼Œä¿æŒå‰ç«¯ä¸å˜ï¼Œå¤§å¹…é™ä½éƒ¨ç½²å¤æ‚åº¦ã€‚

## ğŸ“Š æ¶æ„å¯¹æ¯”

| ç»„ä»¶ | åŸç³»ç»Ÿï¼ˆNode.jsï¼‰ | æ–°ç³»ç»Ÿï¼ˆPythonï¼‰ |
|------|------------------|-----------------|
| **åç«¯æ¡†æ¶** | Node.js + Fastify | Python + FastAPI |
| **æ•°æ®åº“** | PostgreSQL + pgvector | SQLite + Faiss |
| **æ¶ˆæ¯é˜Ÿåˆ—** | BullMQ + Redis | asyncio.Queue |
| **æ–‡ä»¶å­˜å‚¨** | MinIO | æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ |
| **LLM** | æœ¬åœ°vLLM (3ä¸ªå®¹å™¨) | æ™ºè°±AI API |
| **å‘é‡æ¨¡å‹** | BGE-M3 (æœ¬åœ°) | æ™ºè°±Embedding-3 |
| **é‡æ’åº** | BGE-Reranker (æœ¬åœ°) | æ™ºè°±Rerank-2 |
| **å‰ç«¯** | React + Vite + Tailwind | **ä¿æŒä¸å˜** âœ… |

## ğŸš€ æ ¸å¿ƒä¼˜åŠ¿

### 1. éƒ¨ç½²ç®€åŒ–
```bash
# åŸç³»ç»Ÿï¼šéœ€è¦å¯åŠ¨6ä¸ªDockerå®¹å™¨
docker compose up -d  # postgres, redis, minio, vllm-chat, vllm-embed, vllm-rerank

# æ–°ç³»ç»Ÿï¼šç›´æ¥è¿è¡ŒPython
python server/main.py  # å•ä¸ªè¿›ç¨‹ï¼
```

### 2. ä¾èµ–å‡å°‘
- **ç§»é™¤ä¾èµ–**: Docker, Redis, PostgreSQL, MinIO, nvidia-docker, HuggingFaceæ¨¡å‹
- **æ–°å¢ä¾èµ–**: ä»…éœ€Python 3.11+ å’Œæ™ºè°±APIå¯†é’¥
- **ä»£ç é‡**: é¢„è®¡å‡å°‘ 50%+ (Pythonæ›´ç®€æ´)

### 3. æˆæœ¬ä¼˜åŒ–
- **æ— GPUéœ€æ±‚**: ä¸éœ€è¦RTX 4090ï¼ˆ$2000+ï¼‰
- **æ— æœåŠ¡å™¨æˆæœ¬**: ä¸éœ€è¦äº‘ä¸»æœºè¿è¡Œå¤šä¸ªå®¹å™¨
- **æŒ‰éœ€ä»˜è´¹**: æ™ºè°±APIæŒ‰tokenè®¡è´¹ï¼Œå°è§„æ¨¡ä½¿ç”¨æ›´ä¾¿å®œ

### 4. å¼€å‘æ•ˆç‡
- **ç»Ÿä¸€è¯­è¨€**: Pythonç”Ÿæ€æ›´æˆç†Ÿï¼ˆAI/MLå·¥å…·ä¸°å¯Œï¼‰
- **è°ƒè¯•ç®€å•**: å•è¿›ç¨‹ï¼Œæ— éœ€æ’æŸ¥åˆ†å¸ƒå¼é—®é¢˜
- **å¿«é€Ÿè¿­ä»£**: æ— éœ€é‡å»ºDockeré•œåƒ

## ğŸ“ é¡¹ç›®ç»“æ„

```
contract-precheck-simple/
â”œâ”€â”€ client/                    # å¤ç”¨ç°æœ‰å‰ç«¯ï¼ˆä¸å˜ï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/            # Dashboard, KBAdmin, etc.
â”‚   â”‚   â”œâ”€â”€ components/       # UIç»„ä»¶
â”‚   â”‚   â””â”€â”€ api/              # APIå®¢æˆ·ç«¯ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ server/                    # Pythonåç«¯ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ main.py               # FastAPIå…¥å£
â”‚   â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â”‚   â”œâ”€â”€ database/             # SQLite + SQLAlchemy
â”‚   â”œâ”€â”€ services/             # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ llm_service.py    # æ™ºè°±AIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ kb_service.py     # çŸ¥è¯†åº“ï¼ˆFaissï¼‰
â”‚   â”‚   â””â”€â”€ task_service.py   # ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ agents/               # 8ä¸ªAgentï¼ˆå¼‚æ­¥å‡½æ•°ï¼‰
â”‚   â”œâ”€â”€ orchestrator.py       # ä»»åŠ¡ç¼–æ’å™¨
â”‚   â””â”€â”€ routes/               # APIç«¯ç‚¹ï¼ˆä¸åŸç³»ç»Ÿ100%å…¼å®¹ï¼‰
â”‚
â”œâ”€â”€ storage/                   # æœ¬åœ°æ–‡ä»¶å­˜å‚¨
â”‚   â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ kb_documents/
â”‚   â””â”€â”€ reports/
â”‚
â”œâ”€â”€ data/                      # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ database.db           # SQLiteæ•°æ®åº“
â”‚   â””â”€â”€ faiss_indexes/        # Faissç´¢å¼•æ–‡ä»¶
â”‚
â””â”€â”€ .env                       # ç¯å¢ƒå˜é‡ï¼ˆä»…æ™ºè°±APIå¯†é’¥ï¼‰
```

## ğŸ”‘ å…³é”®æŠ€æœ¯å®ç°

### 1. SQLiteæ›¿ä»£PostgreSQL
- **ä¼˜ç‚¹**: é›¶é…ç½®ã€å•æ–‡ä»¶ã€ä¾¿æº
- **è¶³å¤Ÿä½¿ç”¨**: æ”¯æ’‘ç™¾ä¸‡çº§è®°å½•
- **å…¼å®¹æ€§**: ä½¿ç”¨SQLAlchemy ORMï¼Œæ˜“äºè¿ç§»

### 2. Faissæ›¿ä»£pgvector
```python
# å‘é‡æ£€ç´¢æµç¨‹
query_vector = zhipu_client.embed([query_text])     # æ™ºè°±å‘é‡åŒ–
faiss_results = faiss_index.search(query_vector, k=20)  # Top-20å¬å›
rerank_results = zhipu_client.rerank(query, docs, top_n=6)  # Top-6é‡æ’
```

### 3. æ™ºè°±AIç»Ÿä¸€æ¥å£
```python
class LLMService:
    async def chat(self, messages, temperature=0.7):
        """é£é™©åˆ†æ"""
        return zhipu_client.chat.completions.create(...)

    async def embed(self, texts):
        """å‘é‡åŒ–"""
        return zhipu_client.embeddings.create(...)

    async def rerank(self, query, documents, top_n=6):
        """é‡æ’åº"""
        return zhipu_client.model_api.invoke(...)
```

### 4. asyncioæ›¿ä»£BullMQ
```python
# åŸç³»ç»Ÿï¼šBullMQ + Redis
queue.add('precheck.orchestrator', jobData)

# æ–°ç³»ç»Ÿï¼šasyncio.Task
asyncio.create_task(orchestrator.run_task(task_id))
```

## ğŸ“‹ å®æ–½æ­¥éª¤ï¼ˆ9ä¸ªé˜¶æ®µï¼‰

### Phase 1: é¡¹ç›®åˆå§‹åŒ– (1å¤©)
- åˆ›å»ºç›®å½•ç»“æ„
- ç”Ÿæˆrequirements.txt
- åˆå§‹åŒ–SQLiteæ•°æ®åº“

### Phase 2: æ•°æ®åº“å±‚ (2å¤©)
- SQLAlchemyæ¨¡å‹å®šä¹‰
- æ•°æ®åº“è¿æ¥ç®¡ç†
- ç¼–å†™è¿ç§»è„šæœ¬

### Phase 3: æ ¸å¿ƒæœåŠ¡ (3å¤©)
- æ™ºè°±AIå®¢æˆ·ç«¯
- Faisså‘é‡å­˜å‚¨
- æ–‡ä»¶å­˜å‚¨æœåŠ¡
- ä»»åŠ¡/çŸ¥è¯†åº“æœåŠ¡

### Phase 4: Agentç³»ç»Ÿ (5å¤©)
- å®ç°AgentåŸºç±»
- å®ç°8ä¸ªAgentï¼ˆparse, split, rules, kb_retrieval, llm_risk, evidence, qc, reportï¼‰

### Phase 5: ä»»åŠ¡ç¼–æ’ (2å¤©)
- ä»»åŠ¡ç¼–æ’å™¨ï¼ˆçŠ¶æ€æœºï¼‰
- å–æ¶ˆæœºåˆ¶
- é”™è¯¯é‡è¯•

### Phase 6: APIè·¯ç”± (3å¤©)
- å®ç°6ä¸ªè·¯ç”±æ¨¡å—
- ç¡®ä¿ä¸å‰ç«¯100%å…¼å®¹
- APIæ–‡æ¡£ç”Ÿæˆ

### Phase 7: å‰ç«¯é›†æˆ (1å¤©)
- å¤åˆ¶å‰ç«¯ä»£ç 
- éªŒè¯APIå…¼å®¹æ€§
- ç«¯åˆ°ç«¯æµ‹è¯•

### Phase 8: æµ‹è¯•ä¸ä¼˜åŒ– (3å¤©)
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- æ€§èƒ½æµ‹è¯•
- é”™è¯¯å¤„ç†å®Œå–„

### Phase 9: æ–‡æ¡£ä¸éƒ¨ç½² (1å¤©)
- READMEç¼–å†™
- APIæ–‡æ¡£
- ç¤ºä¾‹æ•°æ®å¯¼å…¥

**æ€»è®¡**: çº¦21å¤©ï¼ˆ3å‘¨ï¼‰

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] çŸ¥è¯†åº“ç®¡ç†ï¼ˆå¯¼å…¥ã€å‘é‡åŒ–ã€æ£€ç´¢ï¼‰
- [ ] åˆåŒä¸Šä¼ ä¸ä»»åŠ¡åˆ›å»º
- [ ] 8é˜¶æ®µå¤„ç†æµç¨‹å®Œæ•´è¿è¡Œ
- [ ] é£é™©ç»“æœå±•ç¤ºï¼ˆå«è¯æ®é“¾ï¼‰
- [ ] æŠ¥å‘Šç”Ÿæˆä¸ä¸‹è½½
- [ ] æ‰€æœ‰å‰ç«¯é¡µé¢åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½æŒ‡æ ‡
- [ ] å•ä»»åŠ¡å¤„ç†æ—¶é—´ < 5åˆ†é’Ÿ
- [ ] æ”¯æŒ3ä¸ªå¹¶å‘ä»»åŠ¡
- [ ] çŸ¥è¯†åº“æ£€ç´¢ < 2ç§’

### ä»£ç è´¨é‡
- [ ] ç±»å‹æ³¨è§£è¦†ç›–ç‡ > 80%
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 60%
- [ ] å®Œæ•´çš„READMEå’ŒAPIæ–‡æ¡£

## ğŸ“ å­¦ä¹ èµ„æº

### Python/FastAPI
- [FastAPIå®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [SQLAlchemy 2.0æ–‡æ¡£](https://docs.sqlalchemy.org/en/20/)

### Faisså‘é‡æ£€ç´¢
- [Faisså®˜æ–¹æ•™ç¨‹](https://faiss.ai/index.html)
- [å‘é‡æ£€ç´¢æœ€ä½³å®è·µ](https://zilliz.com/learn)

### æ™ºè°±AI
- [æ™ºè°±AIå¼€æ”¾å¹³å°](https://open.bigmodel.cn/)
- [Python SDKæ–‡æ¡£](https://github.com/zhipuai/zhipuai-python)

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: SQLiteæ€§èƒ½å¤Ÿå—ï¼Ÿ
**A**: å¤Ÿç”¨ã€‚SQLiteæ”¯æŒç™¾ä¸‡çº§è®°å½•ï¼Œå¯¹äºä¸­å°è§„æ¨¡åº”ç”¨å®Œå…¨è¶³å¤Ÿã€‚

### Q: Faissç›¸æ¯”pgvectorçš„ä¼˜åŠ¿ï¼Ÿ
**A**:
- æ€§èƒ½æ›´å¥½ï¼ˆC++å®ç°ï¼‰
- æ— éœ€é¢å¤–æœåŠ¡
- æ”¯æŒGPUåŠ é€Ÿï¼ˆå¯é€‰ï¼‰

### Q: æ™ºè°±APIæˆæœ¬å¦‚ä½•ï¼Ÿ
**A**:
- GLM-4-Flash: Â¥0.1/1M tokensï¼ˆæä¾¿å®œï¼‰
- Embedding-3: Â¥0.02/1M tokens
- å°è§„æ¨¡ä½¿ç”¨ï¼ˆæœˆ1000æ¬¡å®¡æŸ¥ï¼‰çº¦ Â¥50-100/æœˆ

### Q: å¦‚ä½•ä¿è¯å‰ç«¯å…¼å®¹æ€§ï¼Ÿ
**A**:
- æ‰€æœ‰APIç«¯ç‚¹è·¯å¾„ä¿æŒä¸€è‡´
- ä½¿ç”¨Pydanticç¡®ä¿JSONæ ¼å¼ä¸€è‡´
- å¯¹æ¯”åŸNode.jså“åº”ç»“æ„

### Q: å¦‚ä½•ä»åŸç³»ç»Ÿè¿ç§»æ•°æ®ï¼Ÿ
**A**:
- PostgreSQL â†’ SQLite: ä½¿ç”¨pg_dump + ä¿®æ”¹è¯­æ³•
- MinIO â†’ æ–‡ä»¶ç³»ç»Ÿ: ç›´æ¥å¤åˆ¶æ–‡ä»¶
- pgvector â†’ Faiss: å¯¼å‡ºå‘é‡ + é‡å»ºç´¢å¼•

## ğŸš¦ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å®‰è£…Python 3.11+
python --version  # åº”æ˜¾ç¤º 3.11.x

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r server/requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
cp .env.example .env
# ç¼–è¾‘.envï¼Œå¡«å…¥æ™ºè°±APIå¯†é’¥
```

### 3. åˆå§‹åŒ–æ•°æ®åº“
```bash
python server/scripts/init_db.py
```

### 4. å¯åŠ¨åç«¯
```bash
python server/main.py
# è®¿é—® http://localhost:3000/docs æŸ¥çœ‹APIæ–‡æ¡£
```

### 5. å¯åŠ¨å‰ç«¯
```bash
cd client
npm install
npm run dev
# è®¿é—® http://localhost:5173
```

### 6. æµ‹è¯•æµç¨‹
1. è®¿é—®çŸ¥è¯†åº“ç®¡ç†ï¼Œå¯¼å…¥ç¤ºä¾‹æ³•è§„æ–‡æ¡£
2. ä¸Šä¼ åˆåŒæ–‡ä»¶ï¼Œåˆ›å»ºé¢„å®¡ä»»åŠ¡
3. æŸ¥çœ‹å¤„ç†è¿›åº¦ï¼ˆ8é˜¶æ®µï¼‰
4. æŸ¥çœ‹é£é™©ç»“æœå’Œè¯æ®é“¾
5. ç”Ÿæˆå¹¶ä¸‹è½½æŠ¥å‘Š

## ğŸ¯ æ€»ç»“

è¿™ä¸ªé‡æ„æ–¹æ¡ˆå°†**å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿ**ç®€åŒ–ä¸º**å•æœºPythonåº”ç”¨**ï¼Œæ ¸å¿ƒä¼˜åŠ¿ï¼š

âœ… **éƒ¨ç½²æç®€** - æ— éœ€Dockerã€GPUã€äº‘æœåŠ¡å™¨
âœ… **æˆæœ¬ä¼˜åŒ–** - æŒ‰éœ€ä»˜è´¹ï¼Œæ— éœ€ç»´æŠ¤åŸºç¡€è®¾æ–½
âœ… **å¼€å‘é«˜æ•ˆ** - Pythonç”Ÿæ€ä¸°å¯Œï¼Œä»£ç é‡å‡åŠ
âœ… **åŠŸèƒ½å®Œæ•´** - ä¿ç•™æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå‰ç«¯ä¸å˜

é€‚åˆåœºæ™¯:
- ä¸­å°ä¼ä¸šåˆåŒå®¡æŸ¥ç³»ç»Ÿ
- å¿«é€ŸåŸå‹å¼€å‘
- ä¸ªäººé¡¹ç›®/å­¦ä¹ ä½¿ç”¨
- ä¸éœ€è¦é«˜å¹¶å‘å’Œåˆ†å¸ƒå¼éƒ¨ç½²

**ä¸‹ä¸€æ­¥**: æŸ¥çœ‹å®Œæ•´æç¤ºè¯ [REFACTOR_PROMPT.md](./REFACTOR_PROMPT.md) å¼€å§‹å®æ–½ï¼
